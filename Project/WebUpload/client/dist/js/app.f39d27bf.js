(function(e){function t(t){for(var o,a,r=t[0],l=t[1],c=t[2],d=0,p=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&p.push(s[a][0]),s[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,r=1;r<n.length;r++){var l=n[r];0!==s[l]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},s={app:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"08f9":function(e,t,n){},"0d3a":function(e,t,n){},"0fd5":function(e,t,n){},1349:function(e,t,n){"use strict";n("e45f")},2485:function(e,t,n){"use strict";n("0fd5")},"2e16":function(e,t,n){},"3a26":function(e,t,n){"use strict";n("0d3a")},"40d3":function(e,t,n){"use strict";n("5237")},5237:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("a434");var o=n("2b0e"),s=n("5c96"),i=n.n(s),a=(n("0fae"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)}),r=[],l=(n("034f"),n("2877")),c={},u=Object(l["a"])(c,a,r,!1,null,null,null),d=u.exports,p=(n("b64b"),n("8c4f")),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.showErrorMessage?n("alert"):e._e(),n("el-card",{staticClass:"box-card",attrs:{id:"login-card"}},[n("div",{attrs:{id:"title-wrapper"}},[n("h2",[n("p",{staticClass:"title"},[e._v("天天爱K歌")]),n("p",{staticClass:"title"},[e._v("管理员登录")])])]),n("div",{attrs:{id:"login-form-wrapper"}},[n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"用户名",prop:"name"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),n("el-form-item",{attrs:{label:"密码",prop:"pass"}},[n("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm.pass,callback:function(t){e.$set(e.ruleForm,"pass",t)},expression:"ruleForm.pass"}})],1),n("el-form-item",{attrs:{id:"button-wrapper"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("登录")]),n("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("清空")])],1)],1)],1)])],1)},f=[],h=(n("b0c0"),n("bc3a")),g=n.n(h),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-alert",{attrs:{id:"login-alert",title:"用户名或密码错误！",type:"error","show-icon":""}})},b=[],y={},F=y,w=(n("40d3"),Object(l["a"])(F,v,b,!1,null,"76ebc922",null)),C=w.exports,S={data:function(){var e=this,t=function(t,n,o){""===n?o(new Error("请输入用户名")):(""!==e.ruleForm.pass&&e.$refs.ruleForm.validateField("pass"),o())},n=function(e,t,n){""===t?n(new Error("请输入密码")):n()};return{showErrorMessage:!1,ruleForm:{name:"",pass:""},rules:{name:[{validator:t,trigger:"blur"}],pass:[{validator:n,trigger:"blur"}]}}},components:{alert:C},methods:{verify:function(e){var t=this,n="http://localhost:5000/login";g.a.post(n,e).then((function(e){var n=e.data,o={id:n["id"],username:n["username"]};localStorage.setItem("user",JSON.stringify(o)),t.$router.push({path:"/songs"}),t.$store.commit("login")})).catch((function(){t.$message({message:"登录失败。",type:"error"})}))},initForm:function(){this.ruleForm.name="",this.ruleForm.pass=""},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var n={username:t.ruleForm.name,password:t.ruleForm.pass};t.verify(n),t.initForm()}))},resetForm:function(e){this.$refs[e].resetFields()}}},$=S,_=(n("2485"),Object(l["a"])($,m,f,!1,null,"4c9e74a4",null)),x=_.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",{staticClass:"header-wrapper"},[n("h1",{staticClass:"header-title"},[e._v("添加歌曲")]),n("div",{staticClass:"header-button"},[n("el-button",{attrs:{size:"middle",type:"success"},on:{click:e.onSubmit}},[e._v("上传文件")])],1),n("div",{staticClass:"header-button"},[n("el-button",{attrs:{size:"middle"},on:{click:e.redirectToSongs}},[e._v("查看曲库")])],1),n("div",{staticClass:"header-button"},[n("el-button",{attrs:{size:"middle"},on:{click:function(t){e.drawer=!0}}},[e._v("上传队列")])],1)]),n("el-main",[n("div",{attrs:{id:"upload-wrapper"}},[n("el-row",[n("el-col",{attrs:{span:8}},[n("song-info-form",{ref:"songInfo",staticClass:"upload-card"})],1),n("el-col",{attrs:{span:8}},[n("accompany-sing-form",{ref:"accompanySing",staticClass:"upload-card"})],1),n("el-col",{attrs:{span:8}},[n("instrument-sing-form",{ref:"instrumentSing",staticClass:"upload-card"})],1)],1)],1),n("el-drawer",{staticClass:"drawer",attrs:{title:"上传歌曲",visible:e.drawer,direction:"btt"},on:{"update:visible":function(t){e.drawer=t}}},[0===this.$store.state.uploadRequests.length?n("div",{staticClass:"empty-upload"},[e._v(" 没有正在上传的歌曲 ")]):n("ul",{staticStyle:{"list-style":"none"}},e._l(this.$store.state.uploadRequests,(function(t){return n("li",{key:t.songInfo},[n("progress-monitor",{attrs:{"song-info":t.songInfo,uploadFinished:t.uploadFinished,chordFinished:t.chordFinished,instrumentFinished:t.instrumentFinished,rateFinished:t.rateFinished,socket:e.socket}})],1)})),0)])],1)],1)},L=[],O=(n("159b"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("歌曲信息")])]),n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm-inline",attrs:{inline:!0,model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"歌曲名称",prop:"song"}},[n("el-input",{model:{value:e.ruleForm.song,callback:function(t){e.$set(e.ruleForm,"song",t)},expression:"ruleForm.song"}})],1),n("el-form-item",{attrs:{label:"歌手",prop:"singer"}},[n("el-input",{model:{value:e.ruleForm.singer,callback:function(t){e.$set(e.ruleForm,"singer",t)},expression:"ruleForm.singer"}})],1),n("el-form-item",{attrs:{label:"专辑图",prop:"album"}},[n("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://jsonplaceholder.typicode.com/posts/",accept:"image/png","show-file-list":!1,"on-change":e.onCoverChange,"auto-upload":!1}},[e.imageUrl?n("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):n("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1)],1)}),R=[],E=(n("2b3d"),n("d3b7"),n("3ca3"),n("ddb0"),{data:function(){return{album:null,imageUrl:"",ruleForm:{song:"",singer:""},rules:{song:[{required:!0,message:"请输入歌曲名称",trigger:"blur"}],singer:[{required:!0,message:"请输入歌手",trigger:"blur"}],album:[{required:!0}]}}},methods:{onCoverChange:function(e){if(e.raw){var t=e.raw;this.imageUrl=URL.createObjectURL(t),this.album=t}},clearInfo:function(){this.imageUrl="",this.ruleForm.song="",this.ruleForm.singer="",this.album=null}}}),I=E,q=(n("fda0"),Object(l["a"])(I,O,R,!1,null,null,null)),j=q.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("伴奏演唱模式")])]),n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{inline:!0,model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"原唱音频",prop:"original"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.onOriginalChange,"on-preview":e.handlePreview,"on-remove":e.handleOriginalRemove,"on-exceed":e.handleExceed,limit:1,"before-remove":e.beforeRemove,"file-list":e.fileListOriginal,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1),n("el-form-item",{attrs:{label:"伴奏音频",prop:"accompany"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.onAccompanyChange,"on-preview":e.handlePreview,"on-remove":e.handleAccompanyRemove,"on-exceed":e.handleExceed,limit:1,"before-remove":e.beforeRemove,"file-list":e.fileListAccompany,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1),n("el-form-item",{attrs:{label:"歌词",prop:"lyric"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.onLyricChange,"on-preview":e.handlePreview,"on-remove":e.handleLyricRemove,"on-exceed":e.handleExceed,limit:1,"before-remove":e.beforeRemove,"file-list":e.fileListLyric,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1),n("el-form-item",{attrs:{label:"MV",prop:"mv"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.onMVChange,"on-preview":e.handlePreview,"on-remove":e.handleMVRemove,"on-exceed":e.handleExceed,limit:1,"before-remove":e.beforeRemove,"file-list":e.fileListMV,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1)],1)],1)},D=[];n("5319"),n("ac1f"),n("1276");function V(e){var t=e.name.split(".");return t[t.length-1]}var z={data:function(){return{uploadFiles:{},fileListOriginal:[],fileListAccompany:[],fileListLyric:[],fileListMV:[],ruleForm:{},rules:{original:[{required:!0}],accompany:[{required:!0}],lyric:[{required:!0}],mv:[{required:!0}]}}},methods:{onOriginalChange:function(e){if(e.raw){var t=e.raw,n=V(t);"wav"!==n?(this.$message.error("请选择wav格式文件！"),this.fileListOriginal=[]):this.uploadFiles["original"]=t}},onAccompanyChange:function(e){if(e.raw){var t=e.raw,n=V(t);"wav"!==n?(this.$message.error("请选择wav格式文件！"),this.fileListAccompany=[]):this.uploadFiles["accompany"]=t}},onLyricChange:function(e){if(e.raw){var t=e.raw,n=V(t);"lrc"!==n?(this.$message.error("请选择lrc格式文件！"),this.fileListLyric=[]):this.uploadFiles["lyric_accompany"]=t}},onMVChange:function(e){if(e.raw){var t=e.raw,n=V(t);"mp4"!==n?(this.$message.error("请选择mp4格式文件！"),this.fileListMV=[]):this.uploadFiles["mv"]=t}},handleOriginalRemove:function(){delete this.uploadFiles.original},handleAccompanyRemove:function(){delete this.uploadFiles.accompany},handleLyricRemove:function(){delete this.uploadFiles.lyric_accompany},handleMVRemove:function(){delete this.uploadFiles.mv},handlePreview:function(e){console.log(e.raw)},beforeRemove:function(e){return this.$confirm("确定移除 ".concat(e.name,"？"))},handleExceed:function(){this.$message.warning("限制选择 1 个文件")},clearFiles:function(){this.fileListOriginal=[],this.fileListAccompany=[],this.fileListLyric=[],this.fileListMV=[],this.uploadFiles={}}}},M=z,P=Object(l["a"])(M,U,D,!1,null,null,null),A=P.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("自弹自唱模式")])]),n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{inline:!0,model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"和弦",prop:"chord"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.onChordChange,"on-preview":e.handlePreview,"on-remove":e.handleChordRemove,"on-exceed":e.handleExceed,limit:1,"before-remove":e.beforeRemove,"file-list":e.fileListChord,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1)],1)],1)},N=[],B={data:function(){return{uploadFiles:{},ruleForm:{},fileListChord:[],rules:{chord:[{required:!0}],accompany:[{required:!0}]}}},methods:{onChordChange:function(e){if(e.raw){var t=e.raw,n=V(t);"txt"!==n?(this.$message.error("请选择txt格式文件！"),this.fileListChord=[]):this.uploadFiles["chord"]=t}},handleChordRemove:function(){delete this.uploadFiles.chord},handlePreview:function(e){console.log(e)},handleExceed:function(){this.$message.warning("限制选择 1 个文件")},beforeRemove:function(e){return this.$confirm("确定移除 ".concat(e.name,"？"))},clearFiles:function(){this.fileListChord=[],this.uploadFiles={}}}},J=B,W=Object(l["a"])(J,T,N,!1,null,null,null),K=W.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"drawer-content"},[n("span",{staticClass:"monitor-item monitor-song-name"},[e._v(e._s(e.songInfo))]),n("span",{staticClass:"monitor-item"},[e.uploadFinished?n("span",[n("i",{staticClass:"el-icon-success"}),e._v(" 文件上传成功")]):n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 文件上传中")])]),n("span",{staticClass:"monitor-item"},[e.chordFinished?n("span",[n("i",{staticClass:"el-icon-success"}),e._v(" 和弦文件解释成功")]):n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 正在执行和弦解释器")])]),n("span",{staticClass:"monitor-item"},[e.instrumentFinished?n("span",[n("i",{staticClass:"el-icon-success"}),e._v(" AI音轨分离成功")]):n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 正在进行AI音轨分离")])]),n("span",{staticClass:"monitor-item"},[e.rateFinished?n("span",[n("i",{staticClass:"el-icon-success"}),e._v(" 人声基频分析成功")]):n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 正在进行人声基频分析")])])])},H=[],Q={props:{songInfo:String,uploadFinished:Boolean,chordFinished:Boolean,instrumentFinished:Boolean,rateFinished:Boolean}},X=Q,Y=(n("1349"),Object(l["a"])(X,G,H,!1,null,null,null)),Z=Y.exports,ee=n("8e27"),te={data:function(){return{socket:ee("127.0.0.1:5000/karaoke",{transports:["websocket"]}),striped:!0,files:[],progress:[],drawer:!1}},components:{SongInfoForm:j,AccompanySingForm:A,InstrumentSingForm:K,ProgressMonitor:Z},mounted:function(){var e=this;this.socket.on("upload",(function(t){console.log("receive upload"),e.$store.commit("onUploadFinish",t)})),this.socket.on("chord",(function(t){console.log("receive chord"),e.$store.commit("onChordFinish",t)})),this.socket.on("instrument",(function(t){console.log("receive instrument"),e.$store.commit("onInstrumentFinish",t)})),this.socket.on("rate",(function(t){console.log("receive rate"),e.$store.commit("onRateFinish",t)}))},methods:{redirectToSongs:function(){this.$router.push({path:"/songs"})},onSubmit:function(){var e=this,t={headers:{"Content-Type":"multipart/form-data"}},n=new FormData,o=this.$refs.songInfo.ruleForm.song;if(0!==o.length){var s=this.$refs.songInfo.ruleForm.singer;if(0!==s.length){var i=this.$refs.songInfo.album;if(null!==i){var a=this.$refs.accompanySing.uploadFiles;if(4===Object.keys(a).length){var r=this.$refs.instrumentSing.uploadFiles;if(1===Object.keys(r).length){var l=o+"-"+s;for(var c in this.$store.state.uploadRequests.forEach((function(t){t.songInfo!==l||e.$message.error("上传歌曲重复!")})),n.append("song_name",o),n.append("singer",s),n.append("album",i),a)n.append(c,a[c]);for(var u in r)n.append(u,r[u]);var d={songInfo:l,uploadFinished:!1,chordFinished:!1,instrumentFinished:!1,rateFinished:!1};this.$store.commit("addUploadingSong",d),this.$refs.songInfo.clearInfo(),this.$refs.accompanySing.clearFiles(),this.$refs.instrumentSing.clearFiles();var p="http://localhost:5000/uploadSong";g.a.post(p,n,t).then((function(){e.$store.commit("deleteUploadingSong",l),e.$message({message:l+"上传成功！",type:"success"})})).catch((function(){e.$store.commit("deleteUploadingSong",l),e.$message({message:l+"上传失败！",type:"error"})}))}else this.$message.error("请上传自弹自唱模式相关文件！")}else this.$message.error("请上传伴奏演唱模式相关文件！")}else this.$message.error("请上传专辑图片！")}else this.$message.error("请输入歌手！")}else this.$message.error("请输入歌曲名称！")}},computed:{getLoginStatus:function(){return this.$store.state.loginStatus}},watch:{getLoginStatus:function(e){e||this.$router.push({path:"/login"})}}},ne=te,oe=(n("3a26"),Object(l["a"])(ne,k,L,!1,null,"54cfd5d6",null)),se=oe.exports,ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",{staticClass:"header-wrapper"},[n("h1",{staticClass:"header-title"},[e._v("曲库")]),n("div",{staticClass:"header-button"},[n("el-button",{attrs:{size:"middle",type:"success"},on:{click:e.redirectToUpload}},[e._v("添加歌曲")]),n("logout-button")],1)]),n("el-main",[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.songData.filter((function(t){return!e.searchValue||t.song_name.toLowerCase().includes(e.searchValue.toLowerCase())||t.singer.toLowerCase().includes(e.searchValue.toLowerCase())})),height:"calc(100vh - 120px)",border:!1}},[n("el-table-column",{attrs:{fixed:"",prop:"song_name",label:"歌曲",align:"center"}}),n("el-table-column",{attrs:{fixed:"",prop:"singer",label:"歌手",align:"center"}}),n("el-table-column",{attrs:{align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:"搜索歌曲名称或歌手"},on:{change:function(){}},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})]}},{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.handleUpload(t.row)}}},[e._v("上传文件")]),n("el-button",{attrs:{size:"mini",type:"primary",loading:-1!==e.syncSongs.indexOf(t.row.song_name+"-"+t.row.singer)},on:{click:function(n){return e.handleSync(t.row)}}},[e._v("同步文件")]),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),n("song-upload-dialog",{ref:"songUploadDialog",on:{"update-song":e.updateSong}}),n("song-info-editer",{ref:"songInfoEditer",on:{"submit-song-info":e.submitSongInfo}})],1)],1)},ae=[],re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"更新歌曲信息",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",{attrs:{model:e.song}},[n("el-form-item",{attrs:{label:"歌曲名称","label-width":e.editerLabelWidth,required:""}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.song.song_name,callback:function(t){e.$set(e.song,"song_name",t)},expression:"song.song_name"}})],1),n("el-form-item",{attrs:{label:"歌手","label-width":e.editerLabelWidth,required:""}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.song.singer,callback:function(t){e.$set(e.song,"singer",t)},expression:"song.singer"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],1)},le=[],ce={data:function(){return{visible:!1,song:{},editerLabelWidth:"120px"}},methods:{handleCancel:function(){this.visible=!1},handleSubmit:function(){0!==this.song.song_name.length?0!==this.song.singer.length?this.$emit("submit-song-info",this.song):this.$message({type:"error",message:"请输入歌手！"}):this.$message({type:"error",message:"请输入歌曲名称！"})}}},ue=ce,de=Object(l["a"])(ue,re,le,!1,null,null,null),pe=de.exports,me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"上传文件",width:"27%",visible:e.visible},on:{"update:visible":function(t){e.visible=t},closed:e.resetDialog}},[n("div",{staticClass:"dialog-body"},[n("div",{staticClass:"upload-dialog-note"},[e._v(" 请在上传原唱音频、歌词文件或和弦文件后进行文件同步。 ")]),n("el-cascader",{staticClass:"file-type-selector",attrs:{placeholder:"请选择文件类型",options:e.options},on:{change:e.handleCascaderChange},model:{value:e.selectedField,callback:function(t){e.selectedField=t},expression:"selectedField"}}),n("el-upload",{directives:[{name:"show",rawName:"v-show",value:"album"===e.field,expression:"field === 'album'"}],staticClass:"upload-form",attrs:{action:"https://jsonplaceholder.typicode.com/posts/",accept:"image/png","on-remove":e.handleFileRemove,"on-change":e.handleFileChange,"on-exceed":e.handleFileNumberExceed,limit:1,"file-list":e.fileList,"list-type":"picture","auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择图片")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请上传png文件")])],1),n("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!==e.field&&"album"!==e.field,expression:"field !== '' && field !== 'album'"}],staticClass:"upload-form upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-remove":e.handleFileRemove,"on-change":e.handleFileChange,"on-exceed":e.handleFileNumberExceed,limit:1,"file-list":e.fileList,"auto-upload":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请上传"+e._s(e.fileSuffix)+"文件")])],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),n("el-button",{attrs:{type:"primary",loading:e.uploading},on:{click:e.handleSubmit}},[e._v("确定")])],1)])},fe=[],he=(n("8a79"),{data:function(){return{uploading:!1,visible:!1,song:{},selectedField:[],uploadFile:null,fileList:[],options:[{value:"songInfo",label:"歌曲信息",children:[{value:"album",label:"专辑图"}]},{value:"accompanySing",label:"伴奏演唱模式",children:[{value:"original",label:"原唱音频"},{value:"accompany",label:"伴奏音频"},{value:"lyric_accompany",label:"歌词"},{value:"mv",label:"MV"}]},{value:"instrumentSing",label:"自弹自唱模式",children:[{value:"chord",label:"和弦"}]}]}},computed:{field:function(){return 2===this.selectedField.length?this.selectedField[1]:""},fileSuffix:function(){var e={original:"wav",accompany:"wav",lyric:"lrc",mv:"mp4",chord:"txt"};return this.field in e?e[this.field]:""}},methods:{handleCascaderChange:function(){this.uploadFile=null,this.fileList=[]},handleCancel:function(){this.resetDialog()},handleSubmit:function(){null!==this.uploadFile?(this.uploading=!0,this.$emit("update-song",this.song.id)):this.$message({message:"请选择上传文件！",type:"error"})},handleFileRemove:function(){this.uploadFile=null},handleFileChange:function(e){if(e.raw){var t=e.raw;this.checkFileType(t)?this.uploadFile=t:(this.fileList=[],this.$message({message:"文件格式不符合要求！",type:"error"}))}},handleFileNumberExceed:function(){this.$message.warning("限制选择1个文件")},checkFileType:function(e){var t=e.name,n=this.fileSuffix;if(0!==n.length){var o="."+n;return t.endsWith(o)}return!0},resetDialog:function(){this.uploadFile=null,this.fileList=[],this.selectedField=[],this.visible=!1}}}),ge=he,ve=(n("a460"),Object(l["a"])(ge,me,fe,!1,null,"f578a36a",null)),be=ve.exports,ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-button",{on:{click:e.logout}},[e._v("退出登录")])},Fe=[],we={methods:{logout:function(){var e=localStorage.getItem("user");e&&0!==Object.keys(e).length&&localStorage.removeItem("user"),this.$router.push({path:"/login"})}}},Ce=we,Se=Object(l["a"])(Ce,ye,Fe,!1,null,null,null),$e=Se.exports,_e=n("8e27"),xe={data:function(){return{socket:_e("127.0.0.1:5000/karaoke",{transports:["websocket"]}),songData:[],editSong:{},editerVisible:!1,searchValue:""}},components:{SongInfoEditer:pe,SongUploadDialog:be,LogoutButton:$e},mounted:function(){var e=this;this.socket.on("sync-success",(function(t){e.$store.commit("finishSyncSong",t),console.log("Successfully synchronized all the files."),e.$message({message:"成功同步"+t+"的所有文件。",type:"success"})})),this.socket.on("sync-fail",(function(t){e.$store.commit("finishSyncSong",t),console.log("Fail to synchronize the files."),e.$message({message:"同步"+t+"文件失败。",type:"error"})}))},computed:{syncSongs:function(){return this.$store.state.syncSongs}},methods:{onSearchValueChange:function(e){console.log(e)},redirectToUpload:function(){this.$router.push({path:"/upload"})},handleEdit:function(e){var t=JSON.parse(JSON.stringify(e));this.$refs.songInfoEditer.song=t,this.$refs.songInfoEditer.visible=!0},handleUpload:function(e){var t=JSON.parse(JSON.stringify(e));this.$refs.songUploadDialog.song=t,this.$refs.songUploadDialog.visible=!0},handleSync:function(e){var t=JSON.parse(JSON.stringify(e)),n=t.song_name+"-"+t.singer;this.$store.commit("startSyncSong",n),this.syncSong(t.id,n)},handleDelete:function(e){var t=this,n=this.$createElement;this.$msgbox({title:"提示",message:n("p",null,[n("span",null,"确认删除歌曲"),n("span",{style:"color: #af3112"},e.song_name),n("span",null,"及其所有文件？")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",beforeClose:function(n,o,s){"confirm"===n?(o.confirmButtonLoading=!0,o.confirmButtonText="正在删除",t.deleteSong(e,o,s)):s()}}).then((function(){t.$message({type:"success",message:"删除成功!"})}))},getSongData:function(){var e=this,t="http://localhost:5000/getSongs";g.a.get(t).then((function(t){e.songData=t.data})).catch((function(t){console.log(t),e.$message.error("获取歌曲信息失败!")}))},deleteSong:function(e,t,n){var o=this,s="http://localhost:5000/deleteSong";g.a.delete(s,{data:{id:e.id}}).then((function(){o.getSongData(),t.confirmButtonLoading=!1,n()})).catch((function(e){console.log(e),o.$message.error("删除歌曲失败!")}))},submitSongInfo:function(e){var t=this,n="http://localhost:5000/updateSongInfo";g.a.post(n,e).then((function(){t.$refs.songInfoEditer.visible=!1,t.$message({message:"成功更新歌曲信息！",type:"success"}),t.getSongData()})).catch((function(e){console.log(e),t.$message({message:"歌曲信息更新失败。",type:"error"})}))},updateSong:function(e){var t=this,n="http://localhost:5000/uploadOneFile/"+e,o=new FormData,s=this.$refs.songUploadDialog.field,i=this.$refs.songUploadDialog.uploadFile;o.append(s,i);var a={headers:{"Content-Type":"multipart/form-data"}};g.a.post(n,o,a).then((function(){t.$refs.songUploadDialog.uploading=!1,t.$refs.songUploadDialog.resetDialog(),t.$message({message:"成功上传文件！",type:"success"})})).catch((function(){t.$refs.songUploadDialog.uploading=!1,t.$message({message:"文件上传失败。",type:"error"})}))},syncSong:function(e,t){this.socket.emit("sync",e,t)}},created:function(){this.getSongData()}},ke=xe,Le=(n("c693"),Object(l["a"])(ke,ie,ae,!1,null,"19bbd3f8",null)),Oe=Le.exports;o["default"].use(p["a"]);var Re=new p["a"]({mode:"history",base:"/",routes:[{path:"/login",name:"Login",component:x},{path:"/upload",name:"Upload",component:se,meta:{requireAuth:!1}},{path:"/songs",name:"Songs",component:Oe,meta:{requireAuth:!1}}]});Re.beforeEach((function(e,t,n){if(e.matched.some((function(e){return e.meta.requireAuth}))){var o=localStorage.getItem("user");o&&0!==Object.keys(o).length?n():n({path:"/login",query:{redirect:e.fullPath}})}else n()}));var Ee=Re,Ie=n("2f62"),qe=n("0e44");o["default"].use(i.a),o["default"].use(Ie["a"]),o["default"].config.productionTip=!1;var je=new Ie["a"].Store({plugins:[Object(qe["a"])({storage:window.sessionStorage})],state:{loginStatus:!1,uploadRequests:[],syncSongs:[]},mutations:{login:function(e){e.loginStatus=!0},loginExpire:function(e){e.loginStatus=!1},addUploadingSong:function(e,t){e.uploadRequests.push(t)},deleteUploadingSong:function(e,t){for(var n=e.uploadRequests.length,o=0;o<n;o++)if(e.uploadRequests[o].songInfo===t){e.uploadRequests.splice(o,1);break}},onUploadFinish:function(e,t){for(var n=e.uploadRequests.length,o=0;o<n;o++)if(e.uploadRequests[o].songInfo===t){e.uploadRequests[o].uploadFinished=!0;break}},onChordFinish:function(e,t){for(var n=e.uploadRequests.length,o=0;o<n;o++)if(e.uploadRequests[o].songInfo===t){e.uploadRequests[o].chordFinished=!0;break}},onInstrumentFinish:function(e,t){for(var n=e.uploadRequests.length,o=0;o<n;o++)if(e.uploadRequests[o].songInfo===t){e.uploadRequests[o].instrumentFinished=!0;break}},onRateFinish:function(e,t){for(var n=e.uploadRequests.length,o=0;o<n;o++)if(e.uploadRequests[o].songInfo===t){e.uploadRequests[o].rateFinished=!0;break}},startSyncSong:function(e,t){e.syncSongs.push(t)},finishSyncSong:function(e,t){for(var n=e.syncSongs.length,o=0;o<n;o++)if(e.syncSongs[o]==t){e.syncSongs.splice(o,1);break}}},getters:{isLogin:function(){return this.state.loginStatus},getUploadingSongs:function(e){return e.uploadRequests}}});new o["default"]({router:Ee,store:je,render:function(e){return e(d)}}).$mount("#app")},"85ec":function(e,t,n){},a03e:function(e,t,n){},a460:function(e,t,n){"use strict";n("a03e")},c693:function(e,t,n){"use strict";n("2e16")},e45f:function(e,t,n){},fda0:function(e,t,n){"use strict";n("08f9")}});
//# sourceMappingURL=app.f39d27bf.js.map
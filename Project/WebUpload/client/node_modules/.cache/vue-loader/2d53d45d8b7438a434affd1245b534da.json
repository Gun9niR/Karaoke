{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/SongUploadDialog.vue?vue&type=style&index=0&id=2a07ad8e&scoped=true&lang=css&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/SongUploadDialog.vue","mtime":1619515702000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmRpYWxvZy1ib2R5IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgaGVpZ2h0OiAyMzBweDsKfQoKLnVwbG9hZC1mb3JtIHsKICBkaXNwbGF5OiBibG9jazsKICBtYXJnaW4tbGVmdDogM3B4Owp9CgouZmlsZS10eXBlLXNlbGVjdG9yIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIHdpZHRoOiAyMDBweDsKfQoK"},{"version":3,"sources":["SongUploadDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"SongUploadDialog.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-dialog \n    title=\"上传文件\"\n    width=\"27%\"\n    :visible.sync=\"visible\" \n    @closed=\"resetDialog\"\n  >\n\n  <div class=\"dialog-body\">\n    <el-cascader\n      class=\"file-type-selector\"\n      placeholder=\"请选择文件类型\"\n      v-model=\"selectedField\"\n      :options=\"options\"\n      @change=\"handleCascaderChange\" \n    />\n\n    <el-upload\n      v-show=\"field === 'album'\"\n      class=\"upload-form\"\n      action=\"https://jsonplaceholder.typicode.com/posts/\"\n      accept=\"image/png\"\n      :on-remove=\"handleFileRemove\"\n      :on-change=\"handleFileChange\"\n      :on-exceed=\"handleFileNumberExceed\"\n      :limit=\"1\"\n      :file-list=\"fileList\"\n      list-type=\"picture\"\n      :auto-upload=\"false\"\n    >\n      <el-button size=\"small\" type=\"primary\">选择图片</el-button>\n      <div slot=\"tip\" class=\"el-upload__tip\">请上传png文件</div>\n    </el-upload>\n\n    <el-upload\n      v-show=\"field !== '' && field !== 'album'\"\n      class=\"upload-form upload-demo\"\n      action=\"https://jsonplaceholder.typicode.com/posts/\"\n      :on-remove=\"handleFileRemove\"\n      :on-change=\"handleFileChange\"\n      :on-exceed=\"handleFileNumberExceed\"\n      :limit=\"1\"\n      :file-list=\"fileList\"\n      :auto-upload=\"false\"\n    >\n      <el-button size=\"small\" type=\"primary\">选择文件</el-button>\n      <div slot=\"tip\" class=\"el-upload__tip\">请上传{{fileSuffix}}文件</div>\n    </el-upload>\n\n    </div>\n\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"handleCancel\">取消</el-button>\n      <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"uploading\">确定</el-button>\n    </div>\n\n  </el-dialog>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      uploading: false,\n      visible: false,\n      song: {},\n      selectedField: [],\n      uploadFile: null,\n      fileList: [],\n      options: [\n        {\n          value: 'songInfo',\n          label: '歌曲信息',\n          children: [\n            {\n              value: 'album',\n              label: '专辑图',\n            },\n          ],\n        },\n        {\n          value: 'accompanySing',\n          label: '伴奏演唱模式',\n          children: [\n            {\n              value: 'original',\n              label: '原唱音频',\n            },\n            {\n              value: 'accompany_accompany',\n              label: '伴奏音频',\n            },\n            {\n              value: 'lyric',\n              label: '歌词',\n            },\n            {\n              value: 'mv',\n              label: 'MV',\n            },\n          ],\n        },\n        {\n          value: 'instrumentSing',\n          label: '自弹自唱模式',\n          children: [\n            {\n              value: 'instrument',\n              label: '和弦',\n            },\n            {\n              value: 'accompany_instrument',\n              label: '伴奏',\n            },\n          ],\n        },\n        {\n          value: 'rating',\n          label: '歌曲打分',\n          children: [\n            {\n              value: 'rate',\n              label: '人声音频',\n            },\n          ],\n        },\n      ],\n    };\n  },\n\n  computed: {\n    field: function() {\n      return this.selectedField.length === 2 ? this.selectedField[1] : '';\n    },\n    fileSuffix: function() {\n      const typeToSuffix = {\n        'original': 'wav',\n        'accompany_accompany': 'wav',\n        'lyric': 'lrc',\n        'mv': 'mp4',\n        'instrument': 'txt',\n        'accompany_instrument': 'wav',\n        'rate': 'wav',\n      };\n      if (this.field in typeToSuffix)\n        return typeToSuffix[this.field];\n      return '';\n    }\n  },\n\n  methods: {\n    handleCascaderChange() {\n      this.uploadFile = null;\n      this.fileList = [];\n    },\n    handleCancel() {\n      this.resetDialog();\n    },\n    handleSubmit() {\n      if (this.uploadFile === null) {\n        this.$message({\n          message: '请选择上传文件！',\n          type: 'error',\n        });\n        return;\n      }\n      this.uploading = true;\n      this.$emit('update-song', this.song.id);\n    },\n    handleFileRemove() {\n      this.uploadFile = null;\n    },\n    handleFileChange(file) {\n      if (file.raw) {\n        let fileObj = file.raw;\n        if (!this.checkFileType(fileObj)) {\n          this.fileList = [];\n          this.$message({\n            message: '文件格式不符合要求！',\n            type: 'error',\n          });\n        } else {\n          this.uploadFile = fileObj;\n        }\n      }\n    },\n    handleFileNumberExceed() {\n      this.$message.warning('限制选择1个文件');\n    },\n\n    checkFileType(fileObj) {\n      const filename = fileObj.name;\n      const suffix = this.fileSuffix;\n      if (suffix.length !== 0) {\n        let suffixWithDot = '.' + suffix;\n        return filename.endsWith(suffixWithDot);\n      }\n      return true;\n    },\n    resetDialog() {\n      this.uploadFile = null;\n      this.fileList = [];\n      this.selectedField = [];\n      this.visible = false;\n    },\n  },\n\n\n};\n</script>\n\n<style scoped>\n\n.dialog-body {\n  position: relative;\n  height: 230px;\n}\n\n.upload-form {\n  display: block;\n  margin-left: 3px;\n}\n\n.file-type-selector {\n  margin-bottom: 20px;\n  width: 200px;\n}\n\n</style>"]}]}
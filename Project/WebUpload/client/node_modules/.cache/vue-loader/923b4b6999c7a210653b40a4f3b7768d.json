{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/SongUploadDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/SongUploadDialog.vue","mtime":1619515702000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXBsb2FkaW5nOiBmYWxzZSwKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIHNvbmc6IHt9LAogICAgICBzZWxlY3RlZEZpZWxkOiBbXSwKICAgICAgdXBsb2FkRmlsZTogbnVsbCwKICAgICAgZmlsZUxpc3Q6IFtdLAogICAgICBvcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgdmFsdWU6ICdzb25nSW5mbycsCiAgICAgICAgICBsYWJlbDogJ+atjOabsuS/oeaBrycsCiAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdmFsdWU6ICdhbGJ1bScsCiAgICAgICAgICAgICAgbGFiZWw6ICfkuJPovpHlm74nLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHZhbHVlOiAnYWNjb21wYW55U2luZycsCiAgICAgICAgICBsYWJlbDogJ+S8tOWlj+a8lOWUseaooeW8jycsCiAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdmFsdWU6ICdvcmlnaW5hbCcsCiAgICAgICAgICAgICAgbGFiZWw6ICfljp/llLHpn7PpopEnLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdmFsdWU6ICdhY2NvbXBhbnlfYWNjb21wYW55JywKICAgICAgICAgICAgICBsYWJlbDogJ+S8tOWlj+mfs+mikScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YWx1ZTogJ2x5cmljJywKICAgICAgICAgICAgICBsYWJlbDogJ+atjOivjScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YWx1ZTogJ212JywKICAgICAgICAgICAgICBsYWJlbDogJ01WJywKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogJ2luc3RydW1lbnRTaW5nJywKICAgICAgICAgIGxhYmVsOiAn6Ieq5by56Ieq5ZSx5qih5byPJywKICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YWx1ZTogJ2luc3RydW1lbnQnLAogICAgICAgICAgICAgIGxhYmVsOiAn5ZKM5bymJywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHZhbHVlOiAnYWNjb21wYW55X2luc3RydW1lbnQnLAogICAgICAgICAgICAgIGxhYmVsOiAn5Ly05aWPJywKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogJ3JhdGluZycsCiAgICAgICAgICBsYWJlbDogJ+atjOabsuaJk+WIhicsCiAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdmFsdWU6ICdyYXRlJywKICAgICAgICAgICAgICBsYWJlbDogJ+S6uuWjsOmfs+mikScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgIH0sCiAgICAgIF0sCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBmaWVsZDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkRmllbGQubGVuZ3RoID09PSAyID8gdGhpcy5zZWxlY3RlZEZpZWxkWzFdIDogJyc7CiAgICB9LAogICAgZmlsZVN1ZmZpeDogZnVuY3Rpb24oKSB7CiAgICAgIGNvbnN0IHR5cGVUb1N1ZmZpeCA9IHsKICAgICAgICAnb3JpZ2luYWwnOiAnd2F2JywKICAgICAgICAnYWNjb21wYW55X2FjY29tcGFueSc6ICd3YXYnLAogICAgICAgICdseXJpYyc6ICdscmMnLAogICAgICAgICdtdic6ICdtcDQnLAogICAgICAgICdpbnN0cnVtZW50JzogJ3R4dCcsCiAgICAgICAgJ2FjY29tcGFueV9pbnN0cnVtZW50JzogJ3dhdicsCiAgICAgICAgJ3JhdGUnOiAnd2F2JywKICAgICAgfTsKICAgICAgaWYgKHRoaXMuZmllbGQgaW4gdHlwZVRvU3VmZml4KQogICAgICAgIHJldHVybiB0eXBlVG9TdWZmaXhbdGhpcy5maWVsZF07CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBoYW5kbGVDYXNjYWRlckNoYW5nZSgpIHsKICAgICAgdGhpcy51cGxvYWRGaWxlID0gbnVsbDsKICAgICAgdGhpcy5maWxlTGlzdCA9IFtdOwogICAgfSwKICAgIGhhbmRsZUNhbmNlbCgpIHsKICAgICAgdGhpcy5yZXNldERpYWxvZygpOwogICAgfSwKICAgIGhhbmRsZVN1Ym1pdCgpIHsKICAgICAgaWYgKHRoaXMudXBsb2FkRmlsZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogJ+ivt+mAieaLqeS4iuS8oOaWh+S7tu+8gScsCiAgICAgICAgICB0eXBlOiAnZXJyb3InLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnVwbG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZS1zb25nJywgdGhpcy5zb25nLmlkKTsKICAgIH0sCiAgICBoYW5kbGVGaWxlUmVtb3ZlKCkgewogICAgICB0aGlzLnVwbG9hZEZpbGUgPSBudWxsOwogICAgfSwKICAgIGhhbmRsZUZpbGVDaGFuZ2UoZmlsZSkgewogICAgICBpZiAoZmlsZS5yYXcpIHsKICAgICAgICBsZXQgZmlsZU9iaiA9IGZpbGUucmF3OwogICAgICAgIGlmICghdGhpcy5jaGVja0ZpbGVUeXBlKGZpbGVPYmopKSB7CiAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgbWVzc2FnZTogJ+aWh+S7tuagvOW8j+S4jeespuWQiOimgeaxgu+8gScsCiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy51cGxvYWRGaWxlID0gZmlsZU9iajsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVGaWxlTnVtYmVyRXhjZWVkKCkgewogICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+mZkOWItumAieaLqTHkuKrmlofku7YnKTsKICAgIH0sCgogICAgY2hlY2tGaWxlVHlwZShmaWxlT2JqKSB7CiAgICAgIGNvbnN0IGZpbGVuYW1lID0gZmlsZU9iai5uYW1lOwogICAgICBjb25zdCBzdWZmaXggPSB0aGlzLmZpbGVTdWZmaXg7CiAgICAgIGlmIChzdWZmaXgubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgbGV0IHN1ZmZpeFdpdGhEb3QgPSAnLicgKyBzdWZmaXg7CiAgICAgICAgcmV0dXJuIGZpbGVuYW1lLmVuZHNXaXRoKHN1ZmZpeFdpdGhEb3QpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIHJlc2V0RGlhbG9nKCkgewogICAgICB0aGlzLnVwbG9hZEZpbGUgPSBudWxsOwogICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZCA9IFtdOwogICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTsKICAgIH0sCiAgfSwKCgp9Owo="},{"version":3,"sources":["SongUploadDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA","file":"SongUploadDialog.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-dialog \n    title=\"上传文件\"\n    width=\"27%\"\n    :visible.sync=\"visible\" \n    @closed=\"resetDialog\"\n  >\n\n  <div class=\"dialog-body\">\n    <el-cascader\n      class=\"file-type-selector\"\n      placeholder=\"请选择文件类型\"\n      v-model=\"selectedField\"\n      :options=\"options\"\n      @change=\"handleCascaderChange\" \n    />\n\n    <el-upload\n      v-show=\"field === 'album'\"\n      class=\"upload-form\"\n      action=\"https://jsonplaceholder.typicode.com/posts/\"\n      accept=\"image/png\"\n      :on-remove=\"handleFileRemove\"\n      :on-change=\"handleFileChange\"\n      :on-exceed=\"handleFileNumberExceed\"\n      :limit=\"1\"\n      :file-list=\"fileList\"\n      list-type=\"picture\"\n      :auto-upload=\"false\"\n    >\n      <el-button size=\"small\" type=\"primary\">选择图片</el-button>\n      <div slot=\"tip\" class=\"el-upload__tip\">请上传png文件</div>\n    </el-upload>\n\n    <el-upload\n      v-show=\"field !== '' && field !== 'album'\"\n      class=\"upload-form upload-demo\"\n      action=\"https://jsonplaceholder.typicode.com/posts/\"\n      :on-remove=\"handleFileRemove\"\n      :on-change=\"handleFileChange\"\n      :on-exceed=\"handleFileNumberExceed\"\n      :limit=\"1\"\n      :file-list=\"fileList\"\n      :auto-upload=\"false\"\n    >\n      <el-button size=\"small\" type=\"primary\">选择文件</el-button>\n      <div slot=\"tip\" class=\"el-upload__tip\">请上传{{fileSuffix}}文件</div>\n    </el-upload>\n\n    </div>\n\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"handleCancel\">取消</el-button>\n      <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"uploading\">确定</el-button>\n    </div>\n\n  </el-dialog>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      uploading: false,\n      visible: false,\n      song: {},\n      selectedField: [],\n      uploadFile: null,\n      fileList: [],\n      options: [\n        {\n          value: 'songInfo',\n          label: '歌曲信息',\n          children: [\n            {\n              value: 'album',\n              label: '专辑图',\n            },\n          ],\n        },\n        {\n          value: 'accompanySing',\n          label: '伴奏演唱模式',\n          children: [\n            {\n              value: 'original',\n              label: '原唱音频',\n            },\n            {\n              value: 'accompany_accompany',\n              label: '伴奏音频',\n            },\n            {\n              value: 'lyric',\n              label: '歌词',\n            },\n            {\n              value: 'mv',\n              label: 'MV',\n            },\n          ],\n        },\n        {\n          value: 'instrumentSing',\n          label: '自弹自唱模式',\n          children: [\n            {\n              value: 'instrument',\n              label: '和弦',\n            },\n            {\n              value: 'accompany_instrument',\n              label: '伴奏',\n            },\n          ],\n        },\n        {\n          value: 'rating',\n          label: '歌曲打分',\n          children: [\n            {\n              value: 'rate',\n              label: '人声音频',\n            },\n          ],\n        },\n      ],\n    };\n  },\n\n  computed: {\n    field: function() {\n      return this.selectedField.length === 2 ? this.selectedField[1] : '';\n    },\n    fileSuffix: function() {\n      const typeToSuffix = {\n        'original': 'wav',\n        'accompany_accompany': 'wav',\n        'lyric': 'lrc',\n        'mv': 'mp4',\n        'instrument': 'txt',\n        'accompany_instrument': 'wav',\n        'rate': 'wav',\n      };\n      if (this.field in typeToSuffix)\n        return typeToSuffix[this.field];\n      return '';\n    }\n  },\n\n  methods: {\n    handleCascaderChange() {\n      this.uploadFile = null;\n      this.fileList = [];\n    },\n    handleCancel() {\n      this.resetDialog();\n    },\n    handleSubmit() {\n      if (this.uploadFile === null) {\n        this.$message({\n          message: '请选择上传文件！',\n          type: 'error',\n        });\n        return;\n      }\n      this.uploading = true;\n      this.$emit('update-song', this.song.id);\n    },\n    handleFileRemove() {\n      this.uploadFile = null;\n    },\n    handleFileChange(file) {\n      if (file.raw) {\n        let fileObj = file.raw;\n        if (!this.checkFileType(fileObj)) {\n          this.fileList = [];\n          this.$message({\n            message: '文件格式不符合要求！',\n            type: 'error',\n          });\n        } else {\n          this.uploadFile = fileObj;\n        }\n      }\n    },\n    handleFileNumberExceed() {\n      this.$message.warning('限制选择1个文件');\n    },\n\n    checkFileType(fileObj) {\n      const filename = fileObj.name;\n      const suffix = this.fileSuffix;\n      if (suffix.length !== 0) {\n        let suffixWithDot = '.' + suffix;\n        return filename.endsWith(suffixWithDot);\n      }\n      return true;\n    },\n    resetDialog() {\n      this.uploadFile = null;\n      this.fileList = [];\n      this.selectedField = [];\n      this.visible = false;\n    },\n  },\n\n\n};\n</script>\n\n<style scoped>\n\n.dialog-body {\n  position: relative;\n  height: 230px;\n}\n\n.upload-form {\n  display: block;\n  margin-left: 3px;\n}\n\n.file-type-selector {\n  margin-bottom: 20px;\n  width: 200px;\n}\n\n</style>"]}]}
{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Songs.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Songs.vue","mtime":1619516695000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBTb25nSW5mb0VkaXRlciBmcm9tICcuL1NvbmdJbmZvRWRpdGVyJzsKaW1wb3J0IFNvbmdVcGxvYWREaWFsb2cgZnJvbSAnLi9Tb25nVXBsb2FkRGlhbG9nJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc29uZ0RhdGE6IFtdLAogICAgICBlZGl0U29uZzoge30sCiAgICAgIGVkaXRlclZpc2libGU6IGZhbHNlLAogICAgfTsKICB9LAoKICBjb21wb25lbnRzOiB7CiAgICBTb25nSW5mb0VkaXRlciwKICAgIFNvbmdVcGxvYWREaWFsb2csCiAgfSwKCiAgbWV0aG9kczogewogICAgcmVkaXJlY3RUb1VwbG9hZCgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goe3BhdGg6ICcvdXBsb2FkJ30pOwogICAgfSwKICAgIGhhbmRsZUVkaXQocm93KSB7CiAgICAgIGxldCBzb25nID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyb3cpKTsKICAgICAgdGhpcy4kcmVmcy5zb25nSW5mb0VkaXRlci5zb25nID0gc29uZzsKICAgICAgdGhpcy4kcmVmcy5zb25nSW5mb0VkaXRlci52aXNpYmxlID0gdHJ1ZTsKICAgIH0sCiAgICBoYW5kbGVVcGxvYWQocm93KSB7CiAgICAgIGxldCBzb25nID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyb3cpKTsKICAgICAgdGhpcy4kcmVmcy5zb25nVXBsb2FkRGlhbG9nLnNvbmcgPSBzb25nOwogICAgICB0aGlzLiRyZWZzLnNvbmdVcGxvYWREaWFsb2cudmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgaGFuZGxlRGVsZXRlKHJvdykgewogICAgICBjb25zdCBoID0gdGhpcy4kY3JlYXRlRWxlbWVudDsKICAgICAgdGhpcy4kbXNnYm94KHsKICAgICAgICB0aXRsZTogJ+aPkOekuicsCiAgICAgICAgbWVzc2FnZTogaCgncCcsIG51bGwsIFsKICAgICAgICAgIGgoJ3NwYW4nLCBudWxsLCAn56Gu6K6k5Yig6Zmk5q2M5puyJyksCiAgICAgICAgICBoKCdzcGFuJywgeyBzdHlsZTogJ2NvbG9yOiAjYWYzMTEyJyB9LCByb3cuc29uZ19uYW1lKSwKICAgICAgICAgIGgoJ3NwYW4nLCBudWxsLCAn5Y+K5YW25omA5pyJ5paH5Lu277yfJyksCiAgICAgICAgXSksCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgIGJlZm9yZUNsb3NlOiAoYWN0aW9uLCBpbnN0YW5jZSwgZG9uZSkgPT4gewogICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2NvbmZpcm0nKSB7CiAgICAgICAgICAgIGluc3RhbmNlLmNvbmZpcm1CdXR0b25Mb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgaW5zdGFuY2UuY29uZmlybUJ1dHRvblRleHQgPSAn5q2j5Zyo5Yig6ZmkJzsKICAgICAgICAgICAgdGhpcy5kZWxldGVTb25nKHJvdywgaW5zdGFuY2UsIGRvbmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9uZSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgbWVzc2FnZTogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRTb25nRGF0YSgpIHsKICAgICAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9BSkFYX1VSTCArICcvZ2V0U29uZ3MnOwogICAgICBheGlvcy5nZXQodXJsKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zb25nRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICBhbGVydCgiRXJyb3IhIik7CiAgICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlU29uZyhzb25nLCBpbnN0YW5jZSwgZG9uZSkgewogICAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0FKQVhfVVJMICsgJy9kZWxldGVTb25nJzsKICAgICAgYXhpb3MuZGVsZXRlKHVybCwgeyBkYXRhOiB7IGlkOiBzb25nLmlkIH19KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuZ2V0U29uZ0RhdGEoKTsKICAgICAgICAgIGluc3RhbmNlLmNvbmZpcm1CdXR0b25Mb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBkb25lKCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICBhbGVydCgiRXJyb3IhIik7CiAgICAgICAgfSk7CiAgICB9LAogICAgc3VibWl0U29uZ0luZm8oc29uZykgewogICAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0FKQVhfVVJMICsgJy91cGRhdGVTb25nSW5mbyc7CiAgICAgIGF4aW9zLnBvc3QodXJsLCBzb25nKQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuJHJlZnMuc29uZ0luZm9FZGl0ZXIudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfmiJDlip/mm7TmlrDmrYzmm7Lkv6Hmga/vvIEnLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuZ2V0U29uZ0RhdGEoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn5q2M5puy5L+h5oGv5pu05paw5aSx6LSl44CCJywKICAgICAgICAgICAgdHlwZTogJ2Vycm9yJywKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSwKCiAgICB1cGRhdGVTb25nKGlkKSB7CgogICAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0FKQVhfVVJMICsgJy91cGxvYWRPbmVGaWxlLycgKyBpZDsKICAgICAgbGV0IHVwbG9hZEZvcm0gPSBuZXcgRm9ybURhdGEoKTsKICAgICAgbGV0IGZpZWxkID0gdGhpcy4kcmVmcy5zb25nVXBsb2FkRGlhbG9nLmZpZWxkOwogICAgICBsZXQgdXBsb2FkRmlsZSA9IHRoaXMuJHJlZnMuc29uZ1VwbG9hZERpYWxvZy51cGxvYWRGaWxlOwogICAgICB1cGxvYWRGb3JtLmFwcGVuZChmaWVsZCwgdXBsb2FkRmlsZSk7CgogICAgICBsZXQgY29uZmlnID0geyAKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgfQogICAgICB9OwoKICAgICAgYXhpb3MucG9zdCh1cmwsIHVwbG9hZEZvcm0sIGNvbmZpZykKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLiRyZWZzLnNvbmdVcGxvYWREaWFsb2cudXBsb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRyZWZzLnNvbmdVcGxvYWREaWFsb2cucmVzZXREaWFsb2coKTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn5oiQ5Yqf5LiK5Lyg5paH5Lu277yBJywKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy5zb25nVXBsb2FkRGlhbG9nLnVwbG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfmlofku7bkuIrkvKDlpLHotKXjgIInLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9LAogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldFNvbmdEYXRhKCk7CiAgfQp9Owo="},{"version":3,"sources":["Songs.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Songs.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-container>\n    <el-header class=\"header-wrapper\">\n      <h1 class=\"header-title\">曲库</h1>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" type=\"success\" @click=\"redirectToUpload\">添加歌曲</el-button>\n      </div>\n    </el-header>\n\n    <el-main>\n      <el-table\n        :data=\"songData\"\n        height=\"calc(100vh - 120px)\"\n        border\n        style=\"width: 100%\"\n        :header-cell-style=\"{textAlign: 'center'}\"\n        :cell-style=\"{textAlign: 'center'}\"\n      >\n        <el-table-column\n          fixed\n          prop=\"song_name\"\n          label=\"歌曲\"\n        >\n        </el-table-column>\n\n        <el-table-column\n          fixed\n          prop=\"singer\"\n          label=\"歌手\"\n        >\n        </el-table-column>\n\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button\n              size=\"mini\"\n              @click=\"handleEdit(scope.row)\">编辑</el-button>\n            <el-button\n              size=\"mini\"\n              type=\"primary\"\n              @click=\"handleUpload(scope.row)\">上传文件</el-button>\n            <el-button\n              size=\"mini\"\n              type=\"danger\"\n              @click=\"handleDelete(scope.row)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <song-upload-dialog @update-song=\"updateSong\" ref=\"songUploadDialog\" />\n      <song-info-editer @submit-song-info=\"submitSongInfo\" ref=\"songInfoEditer\" />\n    </el-main>\n  </el-container>\n</template>\n\n<script>\nimport axios from 'axios';\nimport SongInfoEditer from './SongInfoEditer';\nimport SongUploadDialog from './SongUploadDialog';\n\nexport default {\n  data() {\n    return {\n      songData: [],\n      editSong: {},\n      editerVisible: false,\n    };\n  },\n\n  components: {\n    SongInfoEditer,\n    SongUploadDialog,\n  },\n\n  methods: {\n    redirectToUpload() {\n      this.$router.push({path: '/upload'});\n    },\n    handleEdit(row) {\n      let song = JSON.parse(JSON.stringify(row));\n      this.$refs.songInfoEditer.song = song;\n      this.$refs.songInfoEditer.visible = true;\n    },\n    handleUpload(row) {\n      let song = JSON.parse(JSON.stringify(row));\n      this.$refs.songUploadDialog.song = song;\n      this.$refs.songUploadDialog.visible = true;\n    },\n    handleDelete(row) {\n      const h = this.$createElement;\n      this.$msgbox({\n        title: '提示',\n        message: h('p', null, [\n          h('span', null, '确认删除歌曲'),\n          h('span', { style: 'color: #af3112' }, row.song_name),\n          h('span', null, '及其所有文件？'),\n        ]),\n        showCancelButton: true,\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n        beforeClose: (action, instance, done) => {\n          if (action === 'confirm') {\n            instance.confirmButtonLoading = true;\n            instance.confirmButtonText = '正在删除';\n            this.deleteSong(row, instance, done);\n          } else {\n            done();\n          }\n        },\n      }).then(() => {\n        this.$message({\n          type: 'success',\n          message: '删除成功!'\n        });\n      });\n    },\n\n    getSongData() {\n      const url = process.env.VUE_APP_AJAX_URL + '/getSongs';\n      axios.get(url)\n        .then((response) => {\n          this.songData = response.data;\n        })\n        .catch((error) => {\n          console.log(error);\n          alert(\"Error!\");\n        });\n    },\n    deleteSong(song, instance, done) {\n      const url = process.env.VUE_APP_AJAX_URL + '/deleteSong';\n      axios.delete(url, { data: { id: song.id }})\n        .then(() => {\n          this.getSongData();\n          instance.confirmButtonLoading = false;\n          done();\n        })\n        .catch((error) => {\n          console.log(error);\n          alert(\"Error!\");\n        });\n    },\n    submitSongInfo(song) {\n      const url = process.env.VUE_APP_AJAX_URL + '/updateSongInfo';\n      axios.post(url, song)\n        .then(() => {\n          this.$refs.songInfoEditer.visible = false;\n          this.$message({\n            message: '成功更新歌曲信息！',\n            type: 'success',\n          });\n          this.getSongData();\n        })\n        .catch((error) => {\n          console.log(error);\n          this.$message({\n            message: '歌曲信息更新失败。',\n            type: 'error',\n          });\n        });\n    },\n\n    updateSong(id) {\n\n      const url = process.env.VUE_APP_AJAX_URL + '/uploadOneFile/' + id;\n      let uploadForm = new FormData();\n      let field = this.$refs.songUploadDialog.field;\n      let uploadFile = this.$refs.songUploadDialog.uploadFile;\n      uploadForm.append(field, uploadFile);\n\n      let config = { \n        headers: { \"Content-Type\": \"multipart/form-data\" }\n      };\n\n      axios.post(url, uploadForm, config)\n        .then(() => {\n          this.$refs.songUploadDialog.uploading = false;\n          this.$refs.songUploadDialog.resetDialog();\n          this.$message({\n            message: '成功上传文件！',\n            type: 'success',\n          });\n        })\n        .catch(() => {\n          this.$refs.songUploadDialog.uploading = false;\n          this.$message({\n            message: '文件上传失败。',\n            type: 'error',\n          });\n        });\n    },\n  },\n\n  created() {\n    this.getSongData();\n  }\n};\n</script>\n\n<style scoped> \n\n.header-title {\n  float: left;\n}\n\n.header-button {\n  float: right;\n  margin-top: 20px;\n}\n\n\n#upload-wrapper {\n  margin: 20px 10px;\n}\n\n.upload-card {\n  float: left;\n  padding: 20px;\n}\n\n.box-card {\n  max-width: 400px;\n  height: 450px;\n}\n\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both\n}\n\n</style>"]}]}
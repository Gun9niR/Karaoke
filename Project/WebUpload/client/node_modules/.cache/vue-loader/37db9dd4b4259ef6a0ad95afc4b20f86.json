{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue?vue&type=style&index=0&id=44fc689e&scoped=true&lang=css&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue","mtime":1619516686000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKIAoKLmhlYWRlci10aXRsZSB7CiAgZmxvYXQ6IGxlZnQ7Cn0KCi5oZWFkZXItYnV0dG9uIHsKICBmbG9hdDogcmlnaHQ7CiAgbWFyZ2luLXRvcDogMjBweDsKICBwYWRkaW5nLWxlZnQ6IDEwcHg7Cn0KCgojdXBsb2FkLXdyYXBwZXIgewogIG1hcmdpbjogMjBweCAxMHB4Owp9CgoudXBsb2FkLWNhcmQgewogIGZsb2F0OiBsZWZ0OwogIHBhZGRpbmc6IDIwcHg7Cn0KCi5ib3gtY2FyZCB7CiAgbWF4LXdpZHRoOiA0MDBweDsKICBoZWlnaHQ6IDQ1MHB4Owp9CgojaW5zdHJ1bWVudC1zaW5nIHsKICBoZWlnaHQ6IDI0NXB4Owp9CgojcmF0aW5nLWZvcm0gewogIHdpZHRoOiA0MDBweDsKICBtYXJnaW4tdG9wOiA1cHg7CiAgaGVpZ2h0OiAxNTguM3B4Owp9CgouY2xlYXJmaXg6YmVmb3JlLAouY2xlYXJmaXg6YWZ0ZXIgewogIGRpc3BsYXk6IHRhYmxlOwogIGNvbnRlbnQ6ICIiOwp9Ci5jbGVhcmZpeDphZnRlciB7CiAgY2xlYXI6IGJvdGgKfQoK"},{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2JA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Upload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-container>\n    <el-header class=\"header-wrapper\">\n      <h1 class=\"header-title\">添加歌曲</h1>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" type=\"success\" @click=\"onSubmit\" :loading=\"uploading\">上传文件</el-button>\n      </div>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" @click=\"redirectToSongs\">查看曲库</el-button>\n      </div>\n    </el-header>\n\n    <el-main>\n      <div id=\"upload-wrapper\">\n        <el-row>          \n          <el-col :span=\"8\">\n            <song-info-form ref=\"songInfo\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <accompany-sing-form ref=\"accompanySing\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <instrument-sing-form ref=\"instrumentSing\" id=\"instrument-sing\" class=\"upload-card\" />\n            <rating-form ref=\"rating\" id=\"rating-form\" class=\"upload-card\" />\n          </el-col>\n        </el-row>\n      </div>\n    </el-main>\n\n  </el-container>\n</template>\n\n<script>\nimport axios from 'axios';\nimport SongInfoForm from \"./SongInfoForm\";\nimport AccompanySingForm from \"./AccompanySingForm\";\nimport InstrumentSingForm from \"./InstrumentSingForm\";\nimport RatingForm from './RatingForm.vue';\n\nexport default {\n  data() {\n    return {\n      uploading: false,\n      files: [],\n    };\n  },\n\n  components: {\n    SongInfoForm,\n    AccompanySingForm,\n    InstrumentSingForm,\n    RatingForm, \n  },\n\n  methods: {\n    redirectToSongs() {\n      this.$router.push({path: '/songs'});\n    },\n    onSubmit() {\n\n      this.uploading = true;\n\n      let config = { \n        headers: { \"Content-Type\": \"multipart/form-data\" }\n      };\n      let uploadForm = new FormData();\n\n      let songName = this.$refs.songInfo.ruleForm.song;\n      if (songName.length === 0) {\n        this.$message.error(\"请输入歌曲名称！\");\n        return;\n      }\n\n      let singer = this.$refs.songInfo.ruleForm.singer;\n      if (singer.length === 0) {\n        this.$message.error(\"请输入歌手！\");\n        return;\n      }\n\n      let album = this.$refs.songInfo.album;\n      if (album === null) {\n        this.$message.error(\"请上传专辑图片！\");\n        return;\n      }\n\n      let accompanyFiles = this.$refs.accompanySing.uploadFiles;\n      if (Object.keys(accompanyFiles).length !== 4) {\n        this.$message.error(\"请上传伴奏演唱模式相关文件！\");\n        return;\n      }\n\n      let instrumentFiles = this.$refs.instrumentSing.uploadFiles;\n      if (Object.keys(instrumentFiles).length !== 2) {\n        this.$message.error(\"请上传自弹自唱模式相关文件！\");\n        return;\n      }\n\n      let ratingFiles = this.$refs.rating.uploadFiles;\n      if (Object.keys(ratingFiles).length !== 1) {\n        this.$message.error(\"请上传歌曲打分相关文件！\");\n        return;\n      }\n\n      uploadForm.append('song_name', songName);\n      uploadForm.append('singer', singer);\n      uploadForm.append('album', album);\n\n      for (let key in accompanyFiles) \n        uploadForm.append(key, accompanyFiles[key]);\n\n      for (let key in instrumentFiles) \n        uploadForm.append(key, instrumentFiles[key]);\n\n      for (let key in ratingFiles)\n        uploadForm.append(key, ratingFiles[key]);\n\n      const url = process.env.VUE_APP_AJAX_URL + '/uploadSong';\n\n      axios.post(url, uploadForm, config)\n        .then(() => {\n            this.$message({\n              message: '歌曲上传成功！',\n              type: 'success',\n            });\n            this.$refs.songInfo.clearInfo();\n            this.$refs.accompanySing.clearFiles();\n            this.$refs.instrumentSing.clearFiles();\n            this.$refs.rating.clearFiles();\n            this.uploading = false;\n          })\n          .catch(() => {\n            this.$message.error('歌曲上传失败。');\n            this.uploading = false;\n          });\n    }\n  },\n\n  computed: {\n    getLoginStatus() {\n      return this.$store.state.loginStatus;\n    },\n  },\n\n  watch: {\n    getLoginStatus(status) {\n      if (!status) {\n        this.$router.push({ path: \"/login\" });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped> \n\n.header-title {\n  float: left;\n}\n\n.header-button {\n  float: right;\n  margin-top: 20px;\n  padding-left: 10px;\n}\n\n\n#upload-wrapper {\n  margin: 20px 10px;\n}\n\n.upload-card {\n  float: left;\n  padding: 20px;\n}\n\n.box-card {\n  max-width: 400px;\n  height: 450px;\n}\n\n#instrument-sing {\n  height: 245px;\n}\n\n#rating-form {\n  width: 400px;\n  margin-top: 5px;\n  height: 158.3px;\n}\n\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both\n}\n\n</style>\n"]}]}
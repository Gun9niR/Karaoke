{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue","mtime":1619516686000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBTb25nSW5mb0Zvcm0gZnJvbSAiLi9Tb25nSW5mb0Zvcm0iOwppbXBvcnQgQWNjb21wYW55U2luZ0Zvcm0gZnJvbSAiLi9BY2NvbXBhbnlTaW5nRm9ybSI7CmltcG9ydCBJbnN0cnVtZW50U2luZ0Zvcm0gZnJvbSAiLi9JbnN0cnVtZW50U2luZ0Zvcm0iOwppbXBvcnQgUmF0aW5nRm9ybSBmcm9tICcuL1JhdGluZ0Zvcm0udnVlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXBsb2FkaW5nOiBmYWxzZSwKICAgICAgZmlsZXM6IFtdLAogICAgfTsKICB9LAoKICBjb21wb25lbnRzOiB7CiAgICBTb25nSW5mb0Zvcm0sCiAgICBBY2NvbXBhbnlTaW5nRm9ybSwKICAgIEluc3RydW1lbnRTaW5nRm9ybSwKICAgIFJhdGluZ0Zvcm0sIAogIH0sCgogIG1ldGhvZHM6IHsKICAgIHJlZGlyZWN0VG9Tb25ncygpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goe3BhdGg6ICcvc29uZ3MnfSk7CiAgICB9LAogICAgb25TdWJtaXQoKSB7CgogICAgICB0aGlzLnVwbG9hZGluZyA9IHRydWU7CgogICAgICBsZXQgY29uZmlnID0geyAKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgfQogICAgICB9OwogICAgICBsZXQgdXBsb2FkRm9ybSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgbGV0IHNvbmdOYW1lID0gdGhpcy4kcmVmcy5zb25nSW5mby5ydWxlRm9ybS5zb25nOwogICAgICBpZiAoc29uZ05hbWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+36L6T5YWl5q2M5puy5ZCN56ew77yBIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgc2luZ2VyID0gdGhpcy4kcmVmcy5zb25nSW5mby5ydWxlRm9ybS5zaW5nZXI7CiAgICAgIGlmIChzaW5nZXIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+36L6T5YWl5q2M5omL77yBIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgYWxidW0gPSB0aGlzLiRyZWZzLnNvbmdJbmZvLmFsYnVtOwogICAgICBpZiAoYWxidW0gPT09IG51bGwpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fkuIrkvKDkuJPovpHlm77niYfvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCBhY2NvbXBhbnlGaWxlcyA9IHRoaXMuJHJlZnMuYWNjb21wYW55U2luZy51cGxvYWRGaWxlczsKICAgICAgaWYgKE9iamVjdC5rZXlzKGFjY29tcGFueUZpbGVzKS5sZW5ndGggIT09IDQpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fkuIrkvKDkvLTlpY/mvJTllLHmqKHlvI/nm7jlhbPmlofku7bvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCBpbnN0cnVtZW50RmlsZXMgPSB0aGlzLiRyZWZzLmluc3RydW1lbnRTaW5nLnVwbG9hZEZpbGVzOwogICAgICBpZiAoT2JqZWN0LmtleXMoaW5zdHJ1bWVudEZpbGVzKS5sZW5ndGggIT09IDIpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fkuIrkvKDoh6rlvLnoh6rllLHmqKHlvI/nm7jlhbPmlofku7bvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCByYXRpbmdGaWxlcyA9IHRoaXMuJHJlZnMucmF0aW5nLnVwbG9hZEZpbGVzOwogICAgICBpZiAoT2JqZWN0LmtleXMocmF0aW5nRmlsZXMpLmxlbmd0aCAhPT0gMSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivt+S4iuS8oOatjOabsuaJk+WIhuebuOWFs+aWh+S7tu+8gSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdXBsb2FkRm9ybS5hcHBlbmQoJ3NvbmdfbmFtZScsIHNvbmdOYW1lKTsKICAgICAgdXBsb2FkRm9ybS5hcHBlbmQoJ3NpbmdlcicsIHNpbmdlcik7CiAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKCdhbGJ1bScsIGFsYnVtKTsKCiAgICAgIGZvciAobGV0IGtleSBpbiBhY2NvbXBhbnlGaWxlcykgCiAgICAgICAgdXBsb2FkRm9ybS5hcHBlbmQoa2V5LCBhY2NvbXBhbnlGaWxlc1trZXldKTsKCiAgICAgIGZvciAobGV0IGtleSBpbiBpbnN0cnVtZW50RmlsZXMpIAogICAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKGtleSwgaW5zdHJ1bWVudEZpbGVzW2tleV0pOwoKICAgICAgZm9yIChsZXQga2V5IGluIHJhdGluZ0ZpbGVzKQogICAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKGtleSwgcmF0aW5nRmlsZXNba2V5XSk7CgogICAgICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0FKQVhfVVJMICsgJy91cGxvYWRTb25nJzsKCiAgICAgIGF4aW9zLnBvc3QodXJsLCB1cGxvYWRGb3JtLCBjb25maWcpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICBtZXNzYWdlOiAn5q2M5puy5LiK5Lyg5oiQ5Yqf77yBJywKICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLiRyZWZzLnNvbmdJbmZvLmNsZWFySW5mbygpOwogICAgICAgICAgICB0aGlzLiRyZWZzLmFjY29tcGFueVNpbmcuY2xlYXJGaWxlcygpOwogICAgICAgICAgICB0aGlzLiRyZWZzLmluc3RydW1lbnRTaW5nLmNsZWFyRmlsZXMoKTsKICAgICAgICAgICAgdGhpcy4kcmVmcy5yYXRpbmcuY2xlYXJGaWxlcygpOwogICAgICAgICAgICB0aGlzLnVwbG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+atjOabsuS4iuS8oOWksei0peOAgicpOwogICAgICAgICAgICB0aGlzLnVwbG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICB9CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGdldExvZ2luU3RhdHVzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUubG9naW5TdGF0dXM7CiAgICB9LAogIH0sCgogIHdhdGNoOiB7CiAgICBnZXRMb2dpblN0YXR1cyhzdGF0dXMpIHsKICAgICAgaWYgKCFzdGF0dXMpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICIvbG9naW4iIH0pOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Upload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-container>\n    <el-header class=\"header-wrapper\">\n      <h1 class=\"header-title\">添加歌曲</h1>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" type=\"success\" @click=\"onSubmit\" :loading=\"uploading\">上传文件</el-button>\n      </div>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" @click=\"redirectToSongs\">查看曲库</el-button>\n      </div>\n    </el-header>\n\n    <el-main>\n      <div id=\"upload-wrapper\">\n        <el-row>          \n          <el-col :span=\"8\">\n            <song-info-form ref=\"songInfo\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <accompany-sing-form ref=\"accompanySing\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <instrument-sing-form ref=\"instrumentSing\" id=\"instrument-sing\" class=\"upload-card\" />\n            <rating-form ref=\"rating\" id=\"rating-form\" class=\"upload-card\" />\n          </el-col>\n        </el-row>\n      </div>\n    </el-main>\n\n  </el-container>\n</template>\n\n<script>\nimport axios from 'axios';\nimport SongInfoForm from \"./SongInfoForm\";\nimport AccompanySingForm from \"./AccompanySingForm\";\nimport InstrumentSingForm from \"./InstrumentSingForm\";\nimport RatingForm from './RatingForm.vue';\n\nexport default {\n  data() {\n    return {\n      uploading: false,\n      files: [],\n    };\n  },\n\n  components: {\n    SongInfoForm,\n    AccompanySingForm,\n    InstrumentSingForm,\n    RatingForm, \n  },\n\n  methods: {\n    redirectToSongs() {\n      this.$router.push({path: '/songs'});\n    },\n    onSubmit() {\n\n      this.uploading = true;\n\n      let config = { \n        headers: { \"Content-Type\": \"multipart/form-data\" }\n      };\n      let uploadForm = new FormData();\n\n      let songName = this.$refs.songInfo.ruleForm.song;\n      if (songName.length === 0) {\n        this.$message.error(\"请输入歌曲名称！\");\n        return;\n      }\n\n      let singer = this.$refs.songInfo.ruleForm.singer;\n      if (singer.length === 0) {\n        this.$message.error(\"请输入歌手！\");\n        return;\n      }\n\n      let album = this.$refs.songInfo.album;\n      if (album === null) {\n        this.$message.error(\"请上传专辑图片！\");\n        return;\n      }\n\n      let accompanyFiles = this.$refs.accompanySing.uploadFiles;\n      if (Object.keys(accompanyFiles).length !== 4) {\n        this.$message.error(\"请上传伴奏演唱模式相关文件！\");\n        return;\n      }\n\n      let instrumentFiles = this.$refs.instrumentSing.uploadFiles;\n      if (Object.keys(instrumentFiles).length !== 2) {\n        this.$message.error(\"请上传自弹自唱模式相关文件！\");\n        return;\n      }\n\n      let ratingFiles = this.$refs.rating.uploadFiles;\n      if (Object.keys(ratingFiles).length !== 1) {\n        this.$message.error(\"请上传歌曲打分相关文件！\");\n        return;\n      }\n\n      uploadForm.append('song_name', songName);\n      uploadForm.append('singer', singer);\n      uploadForm.append('album', album);\n\n      for (let key in accompanyFiles) \n        uploadForm.append(key, accompanyFiles[key]);\n\n      for (let key in instrumentFiles) \n        uploadForm.append(key, instrumentFiles[key]);\n\n      for (let key in ratingFiles)\n        uploadForm.append(key, ratingFiles[key]);\n\n      const url = process.env.VUE_APP_AJAX_URL + '/uploadSong';\n\n      axios.post(url, uploadForm, config)\n        .then(() => {\n            this.$message({\n              message: '歌曲上传成功！',\n              type: 'success',\n            });\n            this.$refs.songInfo.clearInfo();\n            this.$refs.accompanySing.clearFiles();\n            this.$refs.instrumentSing.clearFiles();\n            this.$refs.rating.clearFiles();\n            this.uploading = false;\n          })\n          .catch(() => {\n            this.$message.error('歌曲上传失败。');\n            this.uploading = false;\n          });\n    }\n  },\n\n  computed: {\n    getLoginStatus() {\n      return this.$store.state.loginStatus;\n    },\n  },\n\n  watch: {\n    getLoginStatus(status) {\n      if (!status) {\n        this.$router.push({ path: \"/login\" });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped> \n\n.header-title {\n  float: left;\n}\n\n.header-button {\n  float: right;\n  margin-top: 20px;\n  padding-left: 10px;\n}\n\n\n#upload-wrapper {\n  margin: 20px 10px;\n}\n\n.upload-card {\n  float: left;\n  padding: 20px;\n}\n\n.box-card {\n  max-width: 400px;\n  height: 450px;\n}\n\n#instrument-sing {\n  height: 245px;\n}\n\n#rating-form {\n  width: 400px;\n  margin-top: 5px;\n  height: 158.3px;\n}\n\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both\n}\n\n</style>\n"]}]}
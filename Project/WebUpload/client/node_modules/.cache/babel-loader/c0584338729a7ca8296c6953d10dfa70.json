{"remainingRequest":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/babel-loader/lib/index.js!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/src/components/Upload.vue","mtime":1619516686000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/david/Study/SJTU/Courses/SE/Karaoke/Project/WebUpload/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgU29uZ0luZm9Gb3JtIGZyb20gIi4vU29uZ0luZm9Gb3JtIjsKaW1wb3J0IEFjY29tcGFueVNpbmdGb3JtIGZyb20gIi4vQWNjb21wYW55U2luZ0Zvcm0iOwppbXBvcnQgSW5zdHJ1bWVudFNpbmdGb3JtIGZyb20gIi4vSW5zdHJ1bWVudFNpbmdGb3JtIjsKaW1wb3J0IFJhdGluZ0Zvcm0gZnJvbSAnLi9SYXRpbmdGb3JtLnZ1ZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXBsb2FkaW5nOiBmYWxzZSwKICAgICAgZmlsZXM6IFtdCiAgICB9OwogIH0sCiAgY29tcG9uZW50czogewogICAgU29uZ0luZm9Gb3JtOiBTb25nSW5mb0Zvcm0sCiAgICBBY2NvbXBhbnlTaW5nRm9ybTogQWNjb21wYW55U2luZ0Zvcm0sCiAgICBJbnN0cnVtZW50U2luZ0Zvcm06IEluc3RydW1lbnRTaW5nRm9ybSwKICAgIFJhdGluZ0Zvcm06IFJhdGluZ0Zvcm0KICB9LAogIG1ldGhvZHM6IHsKICAgIHJlZGlyZWN0VG9Tb25nczogZnVuY3Rpb24gcmVkaXJlY3RUb1NvbmdzKCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgcGF0aDogJy9zb25ncycKICAgICAgfSk7CiAgICB9LAogICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdGhpcy51cGxvYWRpbmcgPSB0cnVlOwogICAgICB2YXIgY29uZmlnID0gewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICJDb250ZW50LVR5cGUiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciB1cGxvYWRGb3JtID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIHZhciBzb25nTmFtZSA9IHRoaXMuJHJlZnMuc29uZ0luZm8ucnVsZUZvcm0uc29uZzsKCiAgICAgIGlmIChzb25nTmFtZS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fovpPlhaXmrYzmm7LlkI3np7DvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBzaW5nZXIgPSB0aGlzLiRyZWZzLnNvbmdJbmZvLnJ1bGVGb3JtLnNpbmdlcjsKCiAgICAgIGlmIChzaW5nZXIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+36L6T5YWl5q2M5omL77yBIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYWxidW0gPSB0aGlzLiRyZWZzLnNvbmdJbmZvLmFsYnVtOwoKICAgICAgaWYgKGFsYnVtID09PSBudWxsKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6K+35LiK5Lyg5LiT6L6R5Zu+54mH77yBIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYWNjb21wYW55RmlsZXMgPSB0aGlzLiRyZWZzLmFjY29tcGFueVNpbmcudXBsb2FkRmlsZXM7CgogICAgICBpZiAoT2JqZWN0LmtleXMoYWNjb21wYW55RmlsZXMpLmxlbmd0aCAhPT0gNCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivt+S4iuS8oOS8tOWlj+a8lOWUseaooeW8j+ebuOWFs+aWh+S7tu+8gSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGluc3RydW1lbnRGaWxlcyA9IHRoaXMuJHJlZnMuaW5zdHJ1bWVudFNpbmcudXBsb2FkRmlsZXM7CgogICAgICBpZiAoT2JqZWN0LmtleXMoaW5zdHJ1bWVudEZpbGVzKS5sZW5ndGggIT09IDIpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fkuIrkvKDoh6rlvLnoh6rllLHmqKHlvI/nm7jlhbPmlofku7bvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciByYXRpbmdGaWxlcyA9IHRoaXMuJHJlZnMucmF0aW5nLnVwbG9hZEZpbGVzOwoKICAgICAgaWYgKE9iamVjdC5rZXlzKHJhdGluZ0ZpbGVzKS5sZW5ndGggIT09IDEpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLor7fkuIrkvKDmrYzmm7LmiZPliIbnm7jlhbPmlofku7bvvIEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKCdzb25nX25hbWUnLCBzb25nTmFtZSk7CiAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKCdzaW5nZXInLCBzaW5nZXIpOwogICAgICB1cGxvYWRGb3JtLmFwcGVuZCgnYWxidW0nLCBhbGJ1bSk7CgogICAgICBmb3IgKHZhciBrZXkgaW4gYWNjb21wYW55RmlsZXMpIHsKICAgICAgICB1cGxvYWRGb3JtLmFwcGVuZChrZXksIGFjY29tcGFueUZpbGVzW2tleV0pOwogICAgICB9CgogICAgICBmb3IgKHZhciBfa2V5IGluIGluc3RydW1lbnRGaWxlcykgewogICAgICAgIHVwbG9hZEZvcm0uYXBwZW5kKF9rZXksIGluc3RydW1lbnRGaWxlc1tfa2V5XSk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIF9rZXkyIGluIHJhdGluZ0ZpbGVzKSB7CiAgICAgICAgdXBsb2FkRm9ybS5hcHBlbmQoX2tleTIsIHJhdGluZ0ZpbGVzW19rZXkyXSk7CiAgICAgIH0KCiAgICAgIHZhciB1cmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0FKQVhfVVJMICsgJy91cGxvYWRTb25nJzsKICAgICAgYXhpb3MucG9zdCh1cmwsIHVwbG9hZEZvcm0sIGNvbmZpZykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogJ+atjOabsuS4iuS8oOaIkOWKn++8gScsCiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuJHJlZnMuc29uZ0luZm8uY2xlYXJJbmZvKCk7CgogICAgICAgIF90aGlzLiRyZWZzLmFjY29tcGFueVNpbmcuY2xlYXJGaWxlcygpOwoKICAgICAgICBfdGhpcy4kcmVmcy5pbnN0cnVtZW50U2luZy5jbGVhckZpbGVzKCk7CgogICAgICAgIF90aGlzLiRyZWZzLnJhdGluZy5jbGVhckZpbGVzKCk7CgogICAgICAgIF90aGlzLnVwbG9hZGluZyA9IGZhbHNlOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuJG1lc3NhZ2UuZXJyb3IoJ+atjOabsuS4iuS8oOWksei0peOAgicpOwoKICAgICAgICBfdGhpcy51cGxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgZ2V0TG9naW5TdGF0dXM6IGZ1bmN0aW9uIGdldExvZ2luU3RhdHVzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUubG9naW5TdGF0dXM7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgZ2V0TG9naW5TdGF0dXM6IGZ1bmN0aW9uIGdldExvZ2luU3RhdHVzKHN0YXR1cykgewogICAgICBpZiAoIXN0YXR1cykgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIHBhdGg6ICIvbG9naW4iCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9Cn07"},{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA,OAAA,KAAA,MAAA,OAAA;AACA,OAAA,YAAA,MAAA,gBAAA;AACA,OAAA,iBAAA,MAAA,qBAAA;AACA,OAAA,kBAAA,MAAA,sBAAA;AACA,OAAA,UAAA,MAAA,kBAAA;AAEA,eAAA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,SAAA,EAAA,KADA;AAEA,MAAA,KAAA,EAAA;AAFA,KAAA;AAIA,GANA;AAQA,EAAA,UAAA,EAAA;AACA,IAAA,YAAA,EAAA,YADA;AAEA,IAAA,iBAAA,EAAA,iBAFA;AAGA,IAAA,kBAAA,EAAA,kBAHA;AAIA,IAAA,UAAA,EAAA;AAJA,GARA;AAeA,EAAA,OAAA,EAAA;AACA,IAAA,eADA,6BACA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA;AACA,KAHA;AAIA,IAAA,QAJA,sBAIA;AAAA;;AAEA,WAAA,SAAA,GAAA,IAAA;AAEA,UAAA,MAAA,GAAA;AACA,QAAA,OAAA,EAAA;AAAA,0BAAA;AAAA;AADA,OAAA;AAGA,UAAA,UAAA,GAAA,IAAA,QAAA,EAAA;AAEA,UAAA,QAAA,GAAA,KAAA,KAAA,CAAA,QAAA,CAAA,QAAA,CAAA,IAAA;;AACA,UAAA,QAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,UAAA;AACA;AACA;;AAEA,UAAA,MAAA,GAAA,KAAA,KAAA,CAAA,QAAA,CAAA,QAAA,CAAA,MAAA;;AACA,UAAA,MAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,QAAA;AACA;AACA;;AAEA,UAAA,KAAA,GAAA,KAAA,KAAA,CAAA,QAAA,CAAA,KAAA;;AACA,UAAA,KAAA,KAAA,IAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,UAAA;AACA;AACA;;AAEA,UAAA,cAAA,GAAA,KAAA,KAAA,CAAA,aAAA,CAAA,WAAA;;AACA,UAAA,MAAA,CAAA,IAAA,CAAA,cAAA,EAAA,MAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,gBAAA;AACA;AACA;;AAEA,UAAA,eAAA,GAAA,KAAA,KAAA,CAAA,cAAA,CAAA,WAAA;;AACA,UAAA,MAAA,CAAA,IAAA,CAAA,eAAA,EAAA,MAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,gBAAA;AACA;AACA;;AAEA,UAAA,WAAA,GAAA,KAAA,KAAA,CAAA,MAAA,CAAA,WAAA;;AACA,UAAA,MAAA,CAAA,IAAA,CAAA,WAAA,EAAA,MAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,cAAA;AACA;AACA;;AAEA,MAAA,UAAA,CAAA,MAAA,CAAA,WAAA,EAAA,QAAA;AACA,MAAA,UAAA,CAAA,MAAA,CAAA,QAAA,EAAA,MAAA;AACA,MAAA,UAAA,CAAA,MAAA,CAAA,OAAA,EAAA,KAAA;;AAEA,WAAA,IAAA,GAAA,IAAA,cAAA;AACA,QAAA,UAAA,CAAA,MAAA,CAAA,GAAA,EAAA,cAAA,CAAA,GAAA,CAAA;AADA;;AAGA,WAAA,IAAA,IAAA,IAAA,eAAA;AACA,QAAA,UAAA,CAAA,MAAA,CAAA,IAAA,EAAA,eAAA,CAAA,IAAA,CAAA;AADA;;AAGA,WAAA,IAAA,KAAA,IAAA,WAAA;AACA,QAAA,UAAA,CAAA,MAAA,CAAA,KAAA,EAAA,WAAA,CAAA,KAAA,CAAA;AADA;;AAGA,UAAA,GAAA,GAAA,OAAA,CAAA,GAAA,CAAA,gBAAA,GAAA,aAAA;AAEA,MAAA,KAAA,CAAA,IAAA,CAAA,GAAA,EAAA,UAAA,EAAA,MAAA,EACA,IADA,CACA,YAAA;AACA,QAAA,KAAA,CAAA,QAAA,CAAA;AACA,UAAA,OAAA,EAAA,SADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAAA;;AAIA,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,SAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,aAAA,CAAA,UAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,cAAA,CAAA,UAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,MAAA,CAAA,UAAA;;AACA,QAAA,KAAA,CAAA,SAAA,GAAA,KAAA;AACA,OAXA,EAYA,KAZA,CAYA,YAAA;AACA,QAAA,KAAA,CAAA,QAAA,CAAA,KAAA,CAAA,SAAA;;AACA,QAAA,KAAA,CAAA,SAAA,GAAA,KAAA;AACA,OAfA;AAgBA;AAhFA,GAfA;AAkGA,EAAA,QAAA,EAAA;AACA,IAAA,cADA,4BACA;AACA,aAAA,KAAA,MAAA,CAAA,KAAA,CAAA,WAAA;AACA;AAHA,GAlGA;AAwGA,EAAA,KAAA,EAAA;AACA,IAAA,cADA,0BACA,MADA,EACA;AACA,UAAA,CAAA,MAAA,EAAA;AACA,aAAA,OAAA,CAAA,IAAA,CAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SAAA;AACA;AACA;AALA;AAxGA,CAAA","sourcesContent":["<template>\n  <el-container>\n    <el-header class=\"header-wrapper\">\n      <h1 class=\"header-title\">添加歌曲</h1>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" type=\"success\" @click=\"onSubmit\" :loading=\"uploading\">上传文件</el-button>\n      </div>\n      <div class=\"header-button\">\n        <el-button size=\"middle\" @click=\"redirectToSongs\">查看曲库</el-button>\n      </div>\n    </el-header>\n\n    <el-main>\n      <div id=\"upload-wrapper\">\n        <el-row>          \n          <el-col :span=\"8\">\n            <song-info-form ref=\"songInfo\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <accompany-sing-form ref=\"accompanySing\" class=\"upload-card\" />\n          </el-col>\n          <el-col :span=\"8\">\n            <instrument-sing-form ref=\"instrumentSing\" id=\"instrument-sing\" class=\"upload-card\" />\n            <rating-form ref=\"rating\" id=\"rating-form\" class=\"upload-card\" />\n          </el-col>\n        </el-row>\n      </div>\n    </el-main>\n\n  </el-container>\n</template>\n\n<script>\nimport axios from 'axios';\nimport SongInfoForm from \"./SongInfoForm\";\nimport AccompanySingForm from \"./AccompanySingForm\";\nimport InstrumentSingForm from \"./InstrumentSingForm\";\nimport RatingForm from './RatingForm.vue';\n\nexport default {\n  data() {\n    return {\n      uploading: false,\n      files: [],\n    };\n  },\n\n  components: {\n    SongInfoForm,\n    AccompanySingForm,\n    InstrumentSingForm,\n    RatingForm, \n  },\n\n  methods: {\n    redirectToSongs() {\n      this.$router.push({path: '/songs'});\n    },\n    onSubmit() {\n\n      this.uploading = true;\n\n      let config = { \n        headers: { \"Content-Type\": \"multipart/form-data\" }\n      };\n      let uploadForm = new FormData();\n\n      let songName = this.$refs.songInfo.ruleForm.song;\n      if (songName.length === 0) {\n        this.$message.error(\"请输入歌曲名称！\");\n        return;\n      }\n\n      let singer = this.$refs.songInfo.ruleForm.singer;\n      if (singer.length === 0) {\n        this.$message.error(\"请输入歌手！\");\n        return;\n      }\n\n      let album = this.$refs.songInfo.album;\n      if (album === null) {\n        this.$message.error(\"请上传专辑图片！\");\n        return;\n      }\n\n      let accompanyFiles = this.$refs.accompanySing.uploadFiles;\n      if (Object.keys(accompanyFiles).length !== 4) {\n        this.$message.error(\"请上传伴奏演唱模式相关文件！\");\n        return;\n      }\n\n      let instrumentFiles = this.$refs.instrumentSing.uploadFiles;\n      if (Object.keys(instrumentFiles).length !== 2) {\n        this.$message.error(\"请上传自弹自唱模式相关文件！\");\n        return;\n      }\n\n      let ratingFiles = this.$refs.rating.uploadFiles;\n      if (Object.keys(ratingFiles).length !== 1) {\n        this.$message.error(\"请上传歌曲打分相关文件！\");\n        return;\n      }\n\n      uploadForm.append('song_name', songName);\n      uploadForm.append('singer', singer);\n      uploadForm.append('album', album);\n\n      for (let key in accompanyFiles) \n        uploadForm.append(key, accompanyFiles[key]);\n\n      for (let key in instrumentFiles) \n        uploadForm.append(key, instrumentFiles[key]);\n\n      for (let key in ratingFiles)\n        uploadForm.append(key, ratingFiles[key]);\n\n      const url = process.env.VUE_APP_AJAX_URL + '/uploadSong';\n\n      axios.post(url, uploadForm, config)\n        .then(() => {\n            this.$message({\n              message: '歌曲上传成功！',\n              type: 'success',\n            });\n            this.$refs.songInfo.clearInfo();\n            this.$refs.accompanySing.clearFiles();\n            this.$refs.instrumentSing.clearFiles();\n            this.$refs.rating.clearFiles();\n            this.uploading = false;\n          })\n          .catch(() => {\n            this.$message.error('歌曲上传失败。');\n            this.uploading = false;\n          });\n    }\n  },\n\n  computed: {\n    getLoginStatus() {\n      return this.$store.state.loginStatus;\n    },\n  },\n\n  watch: {\n    getLoginStatus(status) {\n      if (!status) {\n        this.$router.push({ path: \"/login\" });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped> \n\n.header-title {\n  float: left;\n}\n\n.header-button {\n  float: right;\n  margin-top: 20px;\n  padding-left: 10px;\n}\n\n\n#upload-wrapper {\n  margin: 20px 10px;\n}\n\n.upload-card {\n  float: left;\n  padding: 20px;\n}\n\n.box-card {\n  max-width: 400px;\n  height: 450px;\n}\n\n#instrument-sing {\n  height: 245px;\n}\n\n#rating-form {\n  width: 400px;\n  margin-top: 5px;\n  height: 158.3px;\n}\n\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both\n}\n\n</style>\n"],"sourceRoot":"src/components"}]}